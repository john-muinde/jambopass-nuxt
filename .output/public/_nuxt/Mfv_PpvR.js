import{_ as O}from"./DnHmkm-N.js";import{_ as q}from"./Up7KWAQ2.js";import{a as S}from"./C6-auSY3.js";import{r as R,N as z,a9 as M,_ as W,C as V,aa as A,u as N,o as _,c as $,m as r,A as B,y as E,b as G,w as H,q as U,a as J,F as Z,p as K,t as I,H as Q,j as X}from"./DogeFfG6.js";import{u as Y}from"./BLZYd8VU.js";function ee(d={}){const{type:C="all",cacheTime:p=3600,thumbnailScale:L=.4,enableDflip:f=!0,cdnBaseUrl:m="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174",filters:P={type:"document"}}=d,n=R([]),y=R(!1),v=R(null),h=z(),F=`documents_${C}`;M(F,{maxAge:p,sameSite:!0});const b=async()=>{if(window.pdfjsLib)return window.pdfjsLib;try{return await Promise.all([new Promise(t=>{const e=document.createElement("script");e.src=`${m}/pdf.min.js`,e.onload=t,document.head.appendChild(e)}),new Promise(t=>{const e=document.createElement("script");e.src=`${m}/pdf.worker.min.js`,e.onload=t,document.head.appendChild(e)})]),await new Promise(t=>setTimeout(t,100)),window.pdfjsLib}catch(t){throw console.error("Failed to load PDF.js",t),t}},D=async(t,e=L)=>{try{const u=await(await(await b()).getDocument(t).promise).getPage(1),c=u.getViewport({scale:e}),s=document.createElement("canvas"),w=s.getContext("2d");return s.width=c.width,s.height=c.height,await u.render({canvasContext:w,viewport:c}).promise,s.toDataURL("image/jpeg",.8)}catch(a){return console.error("Error generating thumbnail:",a),null}},j=t=>{const e=t.match(/(\d+\.?\d*)x(\d+\.?\d*)/);return e?{width:parseFloat(e[1]),height:parseFloat(e[2])}:null},x=async(t,e="height")=>{y.value=!0;try{const l=(await t()).map(async o=>{o.slug=o.slug||o.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");let u=0,c=0,s=1,w="unknown";try{if(!o.thumbnail_path&&o.publication_file.toLowerCase().endsWith(".pdf")){const g=await D(o.publication_file);o.thumb=g||void 0}else o.thumbnail_path&&(o.thumb=o.thumbnail_path);if(o.thumb&&e==="height"){const g=j(o.thumb);g&&(c=g.width||1,u=g.height||1,s=c===0?1/0:u/c,s>1?w="portrait":s<1?w="landscape":w="square")}}catch(g){console.error(`Error processing thumbnail for ${o.name}:`,g)}return o.thumb=S(o.thumb),{...o,height:u,width:c,heightWidthRatio:parseFloat(s.toFixed(2)),orientation:w}});return n.value=await Promise.all(l),e==="height"&&(n.value=k(n.value)),y.value=!1,n.value}catch(a){return y.value=!1,v.value=a instanceof Error?a:new Error(String(a)),[]}},k=t=>t.sort((e,a)=>a.heightWidthRatio-e.heightWidthRatio);return{documents:n,loading:y,error:v,processDocuments:x,initializeDflip:(t=n.value)=>{var e;if(!f||!t.length)return!1;if(t.forEach(a=>{a.publication_file.toLowerCase().endsWith(".pdf")&&(window[`df_option_${a.id}`]={source:S(`${a.publication_file}`),outline:[],autoEnableOutline:!1,autoEnableThumbnail:!1,overwritePDFOutline:!1,pageSize:"0",is3D:!0,height:"100",direction:"1",slug:a.slug,wpOptions:"true",id:a.id})}),(e=window.DFLIP)!=null&&e.parseBooks){if(window.DFLIP.parseBooks(),h.currentRoute.value.hash){if(h.currentRoute.value.hash==="#_"){h.replace({hash:""});return}const a=t.find(l=>h.currentRoute.value.hash.includes(l.slug));a&&document.getElementById(`df_${a.id}`).click()}return!0}return console.warn("DFLIP library not loaded"),!1},handleRouteLeave:(t,e)=>{var o;const a=document.querySelector(".df-lightbox-wrapper"),l=a&&a.style.display!=="none";return window.DFLIP&&l?((o=document.querySelector(".df-lightbox-close"))==null||o.click(),!1):!0},filterDocuments:(t="")=>n.value.filter(e=>{const a=Object.entries(P).every(([o,u])=>e[o]===u),l=!t||Object.values(e).some(o=>String(o).toLowerCase().includes(t.toLowerCase()));return a&&l}),generateThumbnail:D,cleanup:()=>{n.value=[],v.value=null}}}const te={class:"document-viewer"},oe={id:"dflip-books",ref:"bookContainer",class:"dflip-books row media-center"},ae=["id","href","data-slug","data-title","thumb","data-df-option"],ne={__name:"DocumentViewer",props:{type:{type:String,required:!0},contentType:{type:String,required:!0},sorting:{type:String,default:"height"}},emits:["retry"],setup(d,{emit:C}){const p=d,L=C,{documents:f,loading:m,error:P,processDocuments:n,initializeDflip:y,handleRouteLeave:v}=ee({type:p.type,thumbnailScale:.4,enableDflip:!0,filters:{type:p.type}}),h=async()=>{const{api:b}=X();return(await b.get("/api/get-media-center")).data[p.type]},F=async()=>{L("retry"),await n(h,p.sorting)};return V(async()=>{await n(h,p.sorting),console.log("Initializing DearFlip..."),console.table(f.value),y()}),A(v),Y({link:[{rel:"stylesheet",href:"/dearflip/dflip/css/dflip.min.css"}],script:[{src:"/dearflip/dflip/js/libs/jquery.min.js",id:"jquery-core-js"},{src:"/dearflip/dflip/js/libs/jquery-migrate.min.js",id:"jquery-migrate-js"},{src:"/dearflip/dflip/js/libs/imagesloaded.min.js",id:"imagesloaded-js"},{src:"/dearflip/dflip/js/libs/masonry.min.js",id:"masonry-js"},{src:"/dearflip/dflip/js/dflip.min.js",id:"dflip-script-js"},{src:"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"},{children:`
                window.dFlipLocation = "https://js.dearflip.com/wp-content/plugins/dflip/assets/";
                window.dFlipWPGlobal = ${JSON.stringify({text:{toggleSound:"Turn on/off Sound",toggleThumbnails:"Toggle Thumbnails",toggleOutline:"Toggle Outline/Bookmark",previousPage:"Previous Page",nextPage:"Next Page",toggleFullscreen:"Toggle Fullscreen",zoomIn:"Zoom In",zoomOut:"Zoom Out",toggleHelp:"Toggle Help",singlePageMode:"Single Page Mode",doublePageMode:"Double Page Mode",downloadPDFFile:"Download PDF File",gotoFirstPage:"Goto First Page",gotoLastPage:"Goto Last Page",share:"Share",search:"Search",print:"Print",mailSubject:"I wanted you to see this FlipBook",mailBody:`Check out this site ${S(N().fullPath)}`,loading:"Loading"},viewerType:"flipbook",mobileViewerType:"auto",moreControls:"download,pageMode,startPage,endPage,sound",hideControls:"altPrev,altNext",leftControls:"outline,thumbnail",rightControls:"fullScreen,share,download,more",hideShareControls:"",scrollWheel:"true",backgroundColor:"rgb(229,229,229)",backgroundImage:"",height:"auto",paddingTop:"30",paddingBottom:"30",paddingLeft:"30",paddingRight:"30",controlsPosition:"bottom",controlsFloating:!0,direction:"1",duration:"800",soundEnable:"true",showDownloadControl:"true",showSearchControl:"false",showPrintControl:"false",enableAnalytics:"true",webgl:"true",hard:"none",autoEnableOutline:"false",autoEnableThumbnail:"false",pageScale:"fit",maxTextureSize:"3200",rangeChunkSize:"1048576",disableRange:!1,zoomRatio:"1.5",flexibility:"1",pageMode:"0",singlePageMode:"0",pageSize:"0",autoPlay:"false",autoPlayDuration:"5000",autoPlayStart:"false",linkTarget:"2",sharePrefix:"flipbook-",pdfVersion:"default",thumbLayout:"book-title-hover",targetWindow:"_popup",buttonClass:"",hasSpiral:!1,spiralColor:"#eee",cover3DType:"plain",color3DCover:"#aaaaaa",color3DSheets:"#fff",flipbook3DTiltAngleUp:"0",flipbook3DTiltAngleLeft:"0",autoPDFLinktoViewer:!1,sideMenuOverlay:!0,displayLightboxPlayIcon:!0,popupBackGroundColor:"#eee",shelfImage:"",enableAutoLinks:!1})}
            `}]}),(b,D)=>{var k;const j=O,x=q;return _(),$("div",te,[r(m)?(_(),B(j,{key:0,type:"loading","content-type":d.contentType},null,8,["content-type"])):E("",!0),!((k=r(f))!=null&&k.length)&&!r(m)&&r(P)==null?(_(),B(j,{key:1,type:"empty","content-type":d.contentType},null,8,["content-type"])):E("",!0),r(P)&&!r(m)?(_(),B(j,{key:2,type:"error","error-sub-message":r(P).message,"content-type":d.contentType,onRetry:F},null,8,["error-sub-message","content-type"])):E("",!0),G(x,null,{default:H(()=>{var T;return[U(J("div",oe,[(_(!0),$(Z,null,K(r(f),i=>(_(),$("a",{id:`df_${i.id}`,key:i.id,href:`/media/${d.type}#${i.slug}/`,class:"_df_thumb","data-slug":i.slug,"data-title":i.name,thumb:("assetsSync"in b?b.assetsSync:r(S))(i.thumb),"data-df-option":`df_option_${i.id}`},I(i.name)+" / "+I(i.heightWidthRatio),9,ae))),128))],512),[[Q,(T=r(f))==null?void 0:T.length]])]}),_:1})])}}},pe=W(ne,[["__scopeId","data-v-4787de86"]]);export{pe as _};
